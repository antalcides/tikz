\documentclass{article}
\usepackage{pgfplots}
\usepackage{tikz}
\usetikzlibrary{matrix}
\usepackage[active,pdftex,tightpage]{preview}
\usetikzlibrary{positioning}
\PreviewEnvironment[]{tikzpicture}
\newcommand{\derivative}[5]{
\begin{scope}[declare function={f(\x)=#1;}]
    \addplot [thick, red, latex-latex] {f(x)} node [anchor=west] {#2};
    \addplot [black, mark=*] coordinates {(#3,{f(#3)}) (#4,{f(#4)})}
        node [pos=0,/pgfplots/point 1] {$P_1$}
        node [pos=1,/pgfplots/point 2] {$P_2$};
    \pgfplotsextra{
        \pgfmathsetmacro\first{f(#3)}
        \pgfmathsetmacro\second{(f(#4)}
        \pgfmathsetmacro\xdiff{#4-#3}
        \pgfmathsetmacro\ydiff{f(#4)-f(#3)}
        \draw (axis cs:#3,\first) -| (axis cs:#4,\second);
        \draw [|-|,yshift=-2ex] (axis cs:#3,\first) -- node [inner sep=1pt,fill=white] {\pgfmathprintnumber{\xdiff}} (axis cs:#4,\first);
        \draw [|-|,xshift=2ex] (axis cs:#4,\first) -- node [inner sep=1pt, fill=white] {\pgfmathprintnumber{\ydiff}} (axis cs:#4,\second);
        \matrix at (rel axis cs:1,1) [matrix of nodes,/pgfplots/point legend] {#5\\};
    }
    \end{scope}
}


\begin{document}

\pgfplotsset{point legend/.style={},
    point 1/.style={anchor=south},
    point 2/.style={anchor=south}
}

\pgfplotsset{
    azetinaplot/.style={
        width=7cm,
        height=7cm,
        axis lines=middle,
        xlabel=$x$,
        ylabel=$y$,
        enlarge y limits,
        clip=false
    }
}

\begin{tikzpicture}
    \begin{axis}[
        azetinaplot,
        domain=-20:370, samples=100,
        xmin=-20, xmax=370,
        point 1/.append style={anchor=south east},
        point 2/.append style={anchor=east}]
    \derivative{sin(\x)}
        {$f(x)=\sin(x)$}
        {290}{340}
        {$P_1=(290\,,\,-0.94)$\\$P_2=(340\,,\,-0.34)$}
    \end{axis}
\end{tikzpicture}


\end{document}

